# KNLP分词

通过学习Jieba、HanLP等分词思想，结合Tire树实现分词。旨在梳理实现思路，改善Jieba分词的实现及代码风格及，为NLP学习爱好者提供易用、易懂的分词工具

### knlp分词引用

```
from knlp.seq_labeling.trie_seg.inference import TrieInference

def test_cut_by_knlp():
    trieTest = TrieInference()
    print(trieTest.knlp_seg("测试分词的结果是否符合预期"))
```



### knlp与jieba分词差异

1.对于字典树的构建，jieba直接使用Python的字典存储词库文件。knlp采用Trie树构建字典树，优化了字典的空间占用。jie字典树构建时间比knlp稍优，但前者空间占用为后者的20倍左右。

2.在分词测试中，对1M大小，100W字左右的文本进行分词，jieba的分词时间在27s左右，而knlp分词的时间在17s左右。knlp暂未对未登录词(词库中未出现的词)进行处理，待继续优化。

3.jieba分词注重功能实现，忽略代码风格、注释规范等，不易理解、学习和研究。knlp在变量命名、注释及代码风格有严格的规范，增加程序可读性。



### knlp与jieba分词测试评估

**1.字典树构建**

对jieba的词库jieba_dict.txt 进行测试 (knlp/seq_labeling/inference.py中 compare_knlp_jieba_init方法)，约34.9w条数据，对字典树构建进行五次测试，结果如下：

|      | 时间(s) | 空间(M) |      |       |
| ---- | ------- | ------- | ---- | ----- |
|      | knlp    | jieba   | knlp | jieba |
| 1    | 1.39    | 1       | 0.56 | 20    |
| 2    | 1.25    | 1       | 0.56 | 20    |
| 3    | 1.32    | 0.97    | 0.56 | 20    |
| 4    | 1.24    | 0.93    | 0.56 | 20    |
| 5    | 1.46    | 1.12    | 0.56 | 20    |

平均时间差：0.328s  jieba略优

空间占用：knlp极大地降低了空间开销

**2.分词测试**

**1）句子分词**：“测试分词的结果是否符合预期”

**结果一致**：['测试', '分词', '的', '结果', '是否', '符合', '预期']

**耗时**：jieba分词耗时： 1089 ， knlp分词耗时： 1442

可以看到jieba在耗时上略优



**2）段落分词：**

段落分词跟句子分词耗时基本相同



**3）文本分词**： 对knlp/data/wait_to_cut.txt 进行测试，文件约1.2M，124W字。测试结果如下：

**时间对比**：

|             | knlp(ms) | jieba(ms) |
| ----------- | -------- | --------- |
| 1           | 17837    | 26983     |
| 2           | 18433    | 27986     |
| 3           | 17864    | 27645     |
| 4           | 17570    | 28909     |
| 5(两个线程) | 40026    | 53133     |

平均时间差：10.5s  knlp更优

**分词结果对比**：

```
原文：
恋上你看书网 630bookla ，最快更新三体（全集）最新章节！
```

```
jieba：
['第', '1', '章', '科学', '边界', '(', '1', ')', '恋上你', '看书', '网', '630', 'bookla', '，', '最快', '更新', '三体', '（', '全集', '）', '最新', '章节', '！',
```

```
knlp：
['第', '1', '章', ' ', '科学', '边界', '(', '1', ')', '\n', '\n', '恋上你', '看书', '网', ' ', '6', '3', '0', 'b', 'o', 'o', 'k', 'l', 'a', ' ', '，', '最快', '更新', '三', '体', '（', '全集', '）', '最新', '章节', '！',
```

knlp 暂未对 630bookla 等未登录词进行处理，其它词分词结果基本一致。